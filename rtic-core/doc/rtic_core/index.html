<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This is a re-usable crate that captures the hardware agnostic proc-macro logic for RTIC’s tasks and resources syntax model (both single and multicore syntax). I.e the user code parsing, analysis and generation for hardware tasks, local resources, shared resources and their locking mechanism, system init and idle tasks."><title>rtic_core - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-b0742ba02757f159.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="rtic_core" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0 (90b35a623 2024-11-26)" data-channel="1.83.0" data-search-js="search-f0d225181b97f9a4.js" data-settings-js="settings-805db61a62df4bd2.js" ><script src="../static.files/storage-1d39b6787ed640ff.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-f070b9041d14864c.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-0111fcff984fae8f.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../rtic_core/index.html">rtic_<wbr>core</a><span class="version">0.1.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#rtic-compilation-passes" title="RTIC Compilation passes">RTIC Compilation passes</a></li><li><a href="#rtic-distributions" title="RTIC distributions">RTIC distributions</a><ul><li><a href="#definition" title="Definition">Definition</a></li><li><a href="#how-to-implement-a-distribution-using-rtic_corerticmacrobuilder" title="How to implement a distribution using `rtic_core::RticMacroBuilder`?">How to implement a distribution using <code>rtic_core::RticMacroBuilder</code>?</a></li></ul></li><li><a href="#guidelines-for-implementing-new-distributions-links-and-link-to-template-distribution" title="Guidelines for implementing new distributions, links, and link to template distribution">Guidelines for implementing new distributions, links, and link to template distribution</a></li></ul><h3><a href="#modules">Crate Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#traits" title="Traits">Traits</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>rtic_core</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/rtic_core/lib.rs.html#1-157">source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This is a re-usable crate that captures the <strong>hardware agnostic</strong> proc-macro logic for RTIC’s tasks and resources syntax model (both single and multicore syntax). I.e the user code parsing, analysis and generation for hardware tasks, local resources, shared resources and their locking mechanism, system init and idle tasks.</p>
<p>In addition, this crate provides utilities for building the actual RTIC crate (known as an <strong>RTIC distribution</strong>) that exports the RTIC framework attribute procedural macro for a specific target hardware architecture. Further more, the same utilizes allow extending the <strong>core syntax</strong> provided by this crate through the concept of <strong>Compilation passes</strong>. As a result, this crate is not meant to be used directly by users who want to write RTIC applications, instead it is used by <strong>RTIC distribution</strong> implementors.</p>
<h4 id="rtic-compilation-passes"><a class="doc-anchor" href="#rtic-compilation-passes">§</a>RTIC Compilation passes</h4>
<p>An rtic compilation pass is is represented in rust by a type that implements the <code>RticPass</code> trait:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>proc_macro2::TokenStream <span class="kw">as </span>TokenStream2;
<span class="kw">pub trait </span>RticPass {
    <span class="kw">fn </span>run_pass(
        <span class="self">self</span>, args: TokenStream2, app_mod: ItemMod,
    ) -&gt; syn::Result&lt;(TokenStream2, ItemMod)&gt;;
}</code></pre></div>
<p>The trait has one method that is quite similar to an attribute proc macro definition. It takes a tokenstream representing the #[rtic::app(..)] attribute and the second argument represent the user RTIC application. The returned value represents the expanded inputs.</p>
<p>The idea here is that a compilation pass does’t expand the entire rtic application, but instead it implements a specific feature-set of the RTIC framework. Then multiple (compatible) passes are chained together to form the whole proc-macro logic for expanding a user application.</p>
<p>For example, a compilation pass may only understand how to expand monotonics, then the output is provided to the next pass which understand how to describe software tasks interms of hardware tasks and message queues. Finally, the output is fed to the lowest level pass which knows how to generate the SRP model from hardware tasks and resources.</p>
<p>This approach allows developing compilation passes contained within their own crates and maintain them separately, then an RTIC distribution crate, can select and integrate a set of passes to form an rtic proc-macro crate with a given set of features provided by the combined passes.</p>
<p>Compilation passes are usually written in a hardware agnostic fashion, and the target specific details can be provided through what we call <code>Backend</code> traits implementations. Each pass may have an associated <code>Backend</code> trait that list some functions which a distribution implements to guide the pass on how to generate code that is directly related to the target hardware. One example of a <strong>compilation pass</strong> and its associated <strong>Backend trait</strong> is the <code>core compilation pass</code> provided by <code>rtic-core</code> crate. The backend trait for that pass is called <code>rtic_core::CorePassBackend</code>.</p>
<h4 id="rtic-distributions"><a class="doc-anchor" href="#rtic-distributions">§</a>RTIC distributions</h4><h5 id="definition"><a class="doc-anchor" href="#definition">§</a>Definition</h5>
<p>An RTIC distribution is a rust crate that exposes the RTIC attribute proc-macro <strong>implemented for a specific hardware architecture, or for a specific micro-controller, or even for a specific target use case (with non-standard syntax)</strong>. For example, we could have a distribution for single core cortex-m devices, another distribution specifically tailored for the multicore RP2040, a distribution for risc-v architecture … etc.</p>
<p>The responsibility for a distribution crate is to:</p>
<ol>
<li>Implement the <strong>low level hardware specific</strong> details and provide/bind that to the hardware agnostic <strong>RTIC compilation passes</strong>.</li>
<li>Integrate a selection of <strong>compatible</strong> Compilation passes and optionally expose them to the user as a set of <strong>features</strong> which the user can select to enable.</li>
<li>Expose the RTIC proc macro generated by <code>RticMacroBuilder</code> after performing the previous two steps</li>
</ol>
<p><img src="https://github.com/zakimadaoui/rtic-mc-experiments/blob/main/modular_arch.white.png?raw=true" alt="stack" /></p>
<p>Distributions allow the RTIC code-base growth more controllable and provides an alternative approach to the older approach in which all the hardware specific details all belong to a single crate maintained by the RTIC team, and users choose an implementation for some specific hardware is chosen by enabling a corresponding rust feature for their target hardware.</p>
<h5 id="how-to-implement-a-distribution-using-rtic_corerticmacrobuilder"><a class="doc-anchor" href="#how-to-implement-a-distribution-using-rtic_corerticmacrobuilder">§</a>How to implement a distribution using <code>rtic_core::RticMacroBuilder</code>?</h5>
<p>todo: provide short example and link to template distro</p>
<h4 id="guidelines-for-implementing-new-distributions-links-and-link-to-template-distribution"><a class="doc-anchor" href="#guidelines-for-implementing-new-distributions-links-and-link-to-template-distribution">§</a>Guidelines for implementing new distributions, links, and link to template distribution</h4>
<p>TODO…</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="errors/index.html" title="mod rtic_core::errors">errors</a></div></li><li><div class="item-name"><a class="mod" href="multibin/index.html" title="mod rtic_core::multibin">multibin</a></div></li><li><div class="item-name"><a class="mod" href="parse_utils/index.html" title="mod rtic_core::parse_utils">parse_<wbr>utils</a></div><div class="desc docblock-short">Provides a utility to streamline parsing and manipulating and reconstructing the tokenstream representation of the #[app(arg1=“val1”, …)] attribute</div></li><li><div class="item-name"><a class="mod" href="rtic_functions/index.html" title="mod rtic_core::rtic_functions">rtic_<wbr>functions</a></div></li><li><div class="item-name"><a class="mod" href="rtic_traits/index.html" title="mod rtic_core::rtic_traits">rtic_<wbr>traits</a></div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Analysis.html" title="struct rtic_core::Analysis">Analysis</a></div></li><li><div class="item-name"><a class="struct" href="struct.App.html" title="struct rtic_core::App">App</a></div></li><li><div class="item-name"><a class="struct" href="struct.AppArgs.html" title="struct rtic_core::AppArgs">AppArgs</a></div><div class="desc docblock-short">Arguments provided to the #[app(…)] macro attribute, this includes paths to PACs, number of cores, and peripherals option.</div></li><li><div class="item-name"><a class="struct" href="struct.RticMacroBuilder.html" title="struct rtic_core::RticMacroBuilder">Rtic<wbr>Macro<wbr>Builder</a></div><div class="desc docblock-short">This should be used to compose an <strong>RTIC distribution</strong>. In other words, it allows building the RTIC <strong>app</strong> macro
By providing the necessary low-level hardware bindings and binding additional <strong>Compilation Passes</strong>
in the case syntax extensions are desired.</div></li><li><div class="item-name"><a class="struct" href="struct.SubAnalysis.html" title="struct rtic_core::SubAnalysis">SubAnalysis</a></div></li><li><div class="item-name"><a class="struct" href="struct.SubApp.html" title="struct rtic_core::SubApp">SubApp</a></div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.CorePassBackend.html" title="trait rtic_core::CorePassBackend">Core<wbr>Pass<wbr>Backend</a></div><div class="desc docblock-short">Interface for providing the low-level hardware bindings specific for a target(s) (A.k.a The Backend) to be used during code generation phase
of the *<em>Core Compilation Pass</em>.</div></li><li><div class="item-name"><a class="trait" href="trait.RticPass.html" title="trait rtic_core::RticPass">Rtic<wbr>Pass</a></div><div class="desc docblock-short">A trait that allows defining a <strong>Compilation Pass</strong>.</div></li></ul></section></div></main></body></html>